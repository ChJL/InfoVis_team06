<!DOCTYPE html>

<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />

    <script>
        L_NO_TOUCH = false;
        L_DISABLE_3D = false;
    </script>

    <style>
        html,
        body {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/leaflet@1.6.0/dist/leaflet.js"></script>
    <script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
    <script
        src="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.js"></script>

    <script src="leaflet/europe.geojson" type="text/javascript"></script>
    <!-- D3 package -->
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.4.11/d3.min.js"></script>


    <link rel="shortcut icon" type="image/x-icon" href="docs/images/favicon.ico" />

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
        integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
        crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
        integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
        crossorigin=""></script>

    <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.6.0/dist/leaflet.css"/> -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" />
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.css" />
    <link rel="stylesheet"
        href="https://cdn.jsdelivr.net/gh/python-visualization/folium/folium/templates/leaflet.awesome.rotate.min.css" />

    <meta name="viewport" content="width=device-width,
                initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <style>
        .slidecontainer {
            width: 70%;
            /* Width of the outside container */
            text-align: center;
            margin: 0 auto;
        }

        .slider {
            -webkit-appearance: none;

            width: 85px;
            height: 25px;
            background: #d3d3d3;
            outline: none;
            opacity: 0.7;
            -webkit-transition: .2s;
            transition: opacity .2s;

        }

        .slider:hover {
            opacity: 1;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 25px;
            height: 25px;
            background: #4CAF50;
            cursor: pointer;
        }

        .slider::-moz-range-thumb {
            width: 25px;
            height: 25px;
            background: #4CAF50;
            cursor: pointer;
        }

        .submit-button {
            display: block;
            width: 70%;
            padding: 0.75rem;
            opacity: 0.7;
            background: #4CAF50;
            color: inherit;
            border-radius: 2px;
            cursor: pointer;
            text-align: center;
            margin: 0 auto;
        }

        .submit-button:hover {
            opacity: 1;
        }

       /* #map {
            margin-top: 20px;
            margin-right: 20px;
            width: 95.0%;
            height: 100.0%;
            min-height: 950px;
            border-radius: 4px 0px;
            position: relative;


        } */

        #barchart {
			padding: 10px;
            /* position: relative;
            left: 30%;
            -webkit-transform: translateX(-50%);
            -ms-transform: translateX(-50%);
            transform: translateX(-50%); */
        }
		html,body{
			height: 100%;
			width: 100%;
		}
		.box{
			height: 100%;
			width: 100%;
			display: flex;
			flex-direction: column;
		}
		.title{
			background-color: #F1F1F1;
			height: 60px;
			line-height: 60px;
			font-size: 32px;
			padding-left: 20px;
		}
		.content{
			flex: 1;
			margin-top: 10px;
			display: flex;
			overflow: hidden;
		}
		.left-box{
			width: 400px;
			background-color: #F1F1F1;
			padding: 10px;
		}
		.right-box{
			width: 400px;
			background-color: #F1F1F1;
		}
		.map{
			flex: 1;
			margin: 0px 10px;
			background-color: #F1F1F1;
		}
		p{
			font-weight: bold;font-size: 20px;
		}
		.slidecontainer p{
			font-size: 12px;
			font-weight: normal;
		}
		#barchart{
			max-height: 840px;
			overflow-y: auto;
			}
			
		
    </style>

</head>

<body>
	<!--外围边框 -->
	<div class="box">
		<!-- 标题栏 -->
		<div class="title">
			Eumap Rev
		</div>
		<!-- 内容区 -->
		<div class="content">
			<!-- 左侧区域 -->
			<div class="left-box">
				<!-- 饼图 -->
				<div class="donut-chart" id="donut-chart" style="border-bottom: 1px solid #A5a5a5;">
					  <p>Result score</p>
				</div>
				
				<div style="margin-top: 10px;">
					 <p>Result score</p>
					 <div style="display: flex;margin-top: 10px;">
						 <div class="slidecontainer">
						     <p>GDP</p>
						     <input type="range" min="1" max="100" value="50" class="slider" id="myRange"></br>
						     <p>Percentage of English Speaker</p>
						     <input type="range" min="1" max="100" value="50" class="slider" id="myRange"></br>
						     <p>Forest cover rate</p>
						     <input type="range" min="1" max="100" value="50" class="slider" id="myRange"></br>
						 </div>
						 <div class="slidecontainer" style="margin-left: 10px;">
						     <p>Population density</p>
						     <input type="range" min="1" max="100" value="50" class="slider" id="myRange"></br>
						     <p>Education</p>
						     <input type="range" min="1" max="100" value="50" class="slider" id="myRange"></br>
						     <p>Air quality</p>
						     <input type="range" min="1" max="100" value="50" class="slider" id="myRange"></br>
						 </div>
						 
					 </div>
				  
				</div>
				
			<!-- 	<div class="col-sm-6">
				  
				</div> -->
				<!--  -->
				<div style="text-align: center;">
					<button type="button" class="btn btn-success" style="width: 200px;">Submit</button>
				</div>
				
				
				<!-- <button type="button" id="submit" class="class="btn btn-success"">
				    Submit
				</button> -->
				
			</div>
			<!-- 地图区域 -->
			<div class="map" id="map"></div>
			<!-- 右侧区域 -->
			<div class="right-box">
				<p style="padding: 10px 0px 0px 10px;">Result score</p>
				<div  id="barchart" >
				    
				</div>
			</div>
		</div>
		
	</div>
  

</body>
<script type="text/javascript" src="eu.js"></script>

<!-- D3 js -->
<script type="text/javascript">
    var dataArray = [70, 57, 45, 40, 30, 20,60,50,30,40,50,40];

    var canvas = d3.select("#barchart")
        .append("svg")
        .attr("width", 380).attr("height", 900);

    var bars = canvas.selectAll("rect")
        .data(dataArray)
        .enter()
        .append("rect")
        .attr('class', 'base')
        .attr("width", function (d) {
            return d * 10;
        })
        .attr("height", 35)
        .attr("y", function (d, i) {
            return i * 70;
        })
        .attr("fill", "#4CAF50");




    /*
    canvas.append("text")
        .text(function(d){
            return d;
        }).attr;
    */

    var dataArray1 = [30, 25, 20, 15, 10, 5];

    var bars1 = canvas.selectAll("rect.addon")
        .data(dataArray1)
        .enter()
        .append("rect")
        .attr('class', 'addon')
        .attr("width", function (d) {
            return d * 10;
        })
        .attr("height", 25)
        .attr("y", function (d, i) {
            return (i * 70) + 5;
        })
        .attr("fill", "orange");
        //.attr("fill-width", "black");
    // 绘制饼图
	// var dataset = {
	//   apples: [53245, 28479, 19697, 24037, 40245],
	// };
	
	// var width = 460,
	//     height = 300,
	//     radius = Math.min(width, height) / 2;
	
	// var color = d3.scale.category20();
	
	// var pie = d3.layout.pie()
	//     .sort(null);
	
	// var arc = d3.svg.arc()
	//     .innerRadius(radius - 100)
	//     .outerRadius(radius - 50);
	
	// var svg = d3.select("donut-chart").append("svg")
	//     .attr("width", width)
	//     .attr("height", height)
	//     .append("g")
	//     .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");
	
	// var path = svg.selectAll("text")
	//     .data(pie(dataset.apples))
	//   .enter().append("path")
	//     .attr("fill", function(d, i) { return color(i); })
	//     .attr("d", arc);
	 var width = 380,
	        height = 350;
	    var data = [10, 20, 50, 30, 80];
	    // sort函数自动隐式执行降序排列，而且数据从顶部开始顺时针展示，传入null可以阻止排序
	    var pie = d3.layout.pie().sort(null);
	    //定义了10中颜色主题
	    var color = d3.scale.category10();
	    var svg = d3.select("#donut-chart").append("svg").attr("width", width).attr("height", height );
	    //定义外半径
	    var outerRadius = width / 3;
	    //定义内半径
	    var innerRadius = width / 4;
	    //定义路径
	    var arc = d3.svg.arc()
	        .innerRadius(innerRadius)
	        .outerRadius(outerRadius);
	
	    //定义了另一种路径函数
	    var arc2 = d3.svg.arc()
	        .innerRadius(innerRadius - 10)
	        .outerRadius(outerRadius + 20)
	
	    var arcs = svg.selectAll("g")
	        .data(pie(data))
	        .enter()
	        .append("g")
	        // 将饼图中心(SVG起点)移至中间
	        .attr("transform", "translate(" + (outerRadius+50)  + "," + (outerRadius+30) + ")")
	        //为每一块元素添加鼠标事件
	        .on("mouseover", function(d) {
	
	            d3.select(this).select("path").transition().attr("d", function(d) {
	                console.log(d);
	                return arc2(d);
	            })
	        })
	        .on("mouseout", function(d){
	            d3.select(this).select("path").transition().attr("d", function(d){
	                return arc(d);
	            })
	        })
	    arcs.append("path")
	        .attr("fill", function(d, i) {
	            return color(i);
	        })
	        .attr("d", function(d) {
	            return arc(d);
	        })
	    arcs.append("text")
	        .attr("transform", function(d) {
	            return "translate(" + arc.centroid(d) + ")";
	        })
	        .attr("text-anchor", "middle")
	        .text(function(d) {
	            return d.value;
	        })

</script>

<!-- Leaflet js -->
<!-- <script type="text/javascript">

    var map_2cc78be8b08d42fd98c130d4d2fe1098 = L.map(
        "map_2cc78be8b08d42fd98c130d4d2fe1098",
        {
            center: [52.0, 4.3],
            crs: L.CRS.EPSG3857,
            zoom: 5,
            zoomControl: true,
            preferCanvas: false,
        }
    );





    var tile_layer_bc69b6c2814a429d8517f564a65ab5c4 = L.tileLayer(
        "https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",
        { "attribution": "Data by \u0026copy; \u003ca href=\"http://openstreetmap.org\"\u003eOpenStreetMap\u003c/a\u003e, under \u003ca href=\"http://www.openstreetmap.org/copyright\"\u003eODbL\u003c/a\u003e.", "detectRetina": false, "maxNativeZoom": 18, "maxZoom": 18, "minZoom": 0, "noWrap": false, "opacity": 1, "subdomains": "abc", "tms": false }
    ).addTo(map_2cc78be8b08d42fd98c130d4d2fe1098);


    function getColor(d) {
        return d > 1000000 ? '#0c2c84' :
            d > 500000 ? '#225ea8' :
                d > 200000 ? '#1d91c0' :
                    d > 100000 ? '#41b6c4' :
                        d > 50000 ? '#7fcdbb' :
                            d > 30000 ? '#c7e9b4' :
                                d > 20000 ? '#edf8b1' :
                                    '#ffffcc';
    }

    function style(feature) {
        return {
            fillColor: getColor(feature.properties.gdp_md_est),
            weight: 1,
            color: 'white',
            fillOpacity: 0.75
        };
    }
    L.geoJson(europe, {
        onEachFeature: function (feature, layer) {
            layer.on({});
        },
        style: style
    }).addTo(map_2cc78be8b08d42fd98c130d4d2fe1098);




</script> -->


<script>

    var map = L.map('map');

    map.createPane('labels');

    // This pane is above markers but below popups
    map.getPane('labels').style.zIndex = 650;

    // Layers in this pane are non-interactive and do not obscure mouse/touch events
    map.getPane('labels').style.pointerEvents = 'none';

    var cartodbAttribution = '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, &copy; <a href="https://carto.com/attribution">CARTO</a>';

    var positron = L.tileLayer('https://{s}.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}.png', {
        attribution: cartodbAttribution
    }).addTo(map);

    var positronLabels = L.tileLayer('http://{s}.basemaps.cartocdn.com/light_only_labels/{z}/{x}/{y}.png', {
        attribution: cartodbAttribution,
        pane: 'labels'
    }).addTo(map);

    //    geojson = L.geoJson(euCountries).addTo(map);
    //
    //    geojson.eachLayer(function (layer) {
    //        layer.bindPopup(layer.feature.properties.pop_est);
    //    });

    function selectRandom(num, from, to) {
        let arr = [];
        let json = {};
        let needNum;

        if (from - to >= 0) {
            console.log(111)
            return 'err'
        }

        if (to - from == to) {
            needNum = parseInt(to) + 1;
        } else {
            needNum = to - from;
        }
        if (num > needNum) {
            return
        } else {
            while (arr.length < num) {
                let ranNum = Math.ceil(Math.random() * needNum);
                if (!json[ranNum]) {
                    json[ranNum] = 1;
                    arr.push(ranNum)
                }
            }
            return arr;
        }
    }



    function getColor(d) {
        return d < 2 ? '#800026' :
            d < 3 ? '#BD0026' :
                d < 4 ? '#E31A1C' :
                    d < 5 ? '#FC4E2A' :
                        d < 6 ? '#FD8D3C' :
                            d < 7 ? '#FEB24C' :
                                d < 8 ? '#FED976' :
                                    d < 9 ? '#800026' :
                                        d < 10 ? '#BD0026' :
                                            d < 11 ? '#E31A1C' :
                                                d < 12 ? '#FC4E2A' :
                                                    d < 13 ? '#FD8D3C' :
                                                        d < 14 ? '#FEB24C' :
                                                            d < 15 ? '#FED976' :
                                                                d < 16 ? '#800026' :
                                                                    d < 17 ? '#BD0026' :
                                                                        d < 18 ? '#E31A1C' :
                                                                            d < 19 ? '#FC4E2A' :
                                                                                d < 20 ? '#FD8D3C' :
                                                                                    d < 21 ? '#FEB24C' :
                                                                                        d < 22 ? '#FED976' :
                                                                                            d < 23 ? '#800026' :
                                                                                                d < 24 ? '#BD0026' :
                                                                                                    d < 25 ? '#E31A1C' :
                                                                                                        d < 26 ? '#FC4E2A' :
                                                                                                            d < 27 ? '#FD8D3C' :
                                                                                                                d < 28 ? '#FEB24C' :
                                                                                                                    d < 29 ? '#FED976' :
                                                                                                                        d < 30 ? '#800026' :
                                                                                                                            d < 31 ? '#BD0026' :
                                                                                                                                d < 32 ? '#E31A1C' :
                                                                                                                                    d < 33 ? '#FC4E2A' :
                                                                                                                                        d < 34 ? '#FD8D3C' :
                                                                                                                                            d < 35 ? '#FEB24C' :
                                                                                                                                                d < 36 ? '#FED976' :
                                                                                                                                                    d < 37 ? '#800026' :
                                                                                                                                                        d < 38 ? '#BD0026' :
                                                                                                                                                            d < 39 ? '#E31A1C' :
                                                                                                                                                                d < 40 ? '#FC4E2A' :
                                                                                                                                                                    '#FFEDA0';
    }
    var myArray = selectRandom(39, 1, 40)

    for (var i = 0; i < myArray.length; i++) {
        euCountries.features[i].id = myArray[i];
    }
    console.info(getColor(39));
    function style(feature) {
        return {
            fillColor: getColor(feature.id),
            weight: 2,
            opacity: 1,
            color: 'white',
            dashArray: '3',
            fillOpacity: 0.7
        };
    }

    L.geoJson(euCountries, { style: style }).addTo(map);
    map.setView({ lat: 57.040182144806664, lng: 75.667968750000002 }, 3);
    console.info(euCountries, myArray);
</script>